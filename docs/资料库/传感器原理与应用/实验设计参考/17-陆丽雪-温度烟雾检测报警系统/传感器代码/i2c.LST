C51 COMPILER V9.56.0.0   I2C                                                               12/18/2019 10:58:23 PAGE 1   


C51 COMPILER V9.56.0.0, COMPILATION OF MODULE I2C
OBJECT MODULE PLACED IN i2c.OBJ
COMPILER INVOKED BY: C:\Keil_v5\C51\BIN\C51.EXE i2c.c OPTIMIZE(8,SPEED) BROWSE DEBUG OBJECTEXTEND TABS(2)

line level    source

   1          #include "reg52.h"
   2          #include "intrins.h"
   3          
   4          //#define somenop {_nop_();_nop_();_nop_();_nop_();_nop_();}    
   5          //#define somenop
   6          // {
   7          //  unsigned char i;
   8          
   9          //  _nop_();
  10          //  _nop_();
  11          //  i = 12;
  12          //  while (--i);
  13          // }
  14          
  15          #define SlaveAddrW 0xA0
  16          #define SlaveAddrR 0xA1
  17          
  18          //总线引脚定义
  19          sbit SDA = P2^1;  /* 数据线 */
  20          sbit SCL = P2^0;  /* 时钟线 */
  21          
  22          void Delay5us()   //@11.0592MHz
  23          {
  24   1        unsigned char i;
  25   1      
  26   1        _nop_();
  27   1        i = 11;
  28   1        while (--i);
  29   1      }
  30          
  31          
  32          
  33          //总线启动条件
  34          void IIC_Start(void)
  35          {
  36   1        SDA = 1;
  37   1        SCL = 1;
  38   1        Delay5us();
  39   1        SDA = 0;
  40   1        Delay5us();
  41   1        SCL = 0;  
  42   1      }
  43          
  44          //总线停止条件
  45          void IIC_Stop(void)
  46          {
  47   1        SDA = 0;
  48   1        SCL = 1;
  49   1        Delay5us();
  50   1        SDA = 1;
  51   1      }
  52          
  53          //应答位控制
  54          void IIC_Ack(bit ackbit)
  55          {
C51 COMPILER V9.56.0.0   I2C                                                               12/18/2019 10:58:23 PAGE 2   

  56   1        if(ackbit) 
  57   1        { 
  58   2          SDA = 0;
  59   2        }
  60   1        else 
  61   1        {
  62   2          SDA = 1;
  63   2        }
  64   1        Delay5us();
  65   1        SCL = 1;
  66   1        Delay5us();
  67   1        SCL = 0;
  68   1        SDA = 1; 
  69   1        Delay5us();
  70   1      }
  71          
  72          //等待应答
  73          bit IIC_WaitAck(void)
  74          {
  75   1        SDA = 1;
  76   1        Delay5us();
  77   1        SCL = 1;
  78   1        Delay5us();
  79   1        if(SDA)    
  80   1        {   
  81   2          SCL = 0;
  82   2          IIC_Stop();
  83   2          return 0;
  84   2        }
  85   1        else  
  86   1        { 
  87   2          SCL = 0;
  88   2          return 1;
  89   2        }
  90   1      }
  91          
  92          //通过I2C总线发送数据
  93          void IIC_SendByte(unsigned char byt)
  94          {
  95   1        unsigned char i;
  96   1        for(i=0;i<8;i++)
  97   1        {   
  98   2          if(byt&0x80) 
  99   2          { 
 100   3            SDA = 1;
 101   3          }
 102   2          else 
 103   2          {
 104   3            SDA = 0;
 105   3          }
 106   2          Delay5us();
 107   2          SCL = 1;
 108   2          byt <<= 1;
 109   2          Delay5us();
 110   2          SCL = 0;
 111   2        }
 112   1      }
 113          
 114          //从I2C总线上接收数据
 115          unsigned char IIC_RecByte(void)
 116          {
 117   1        unsigned char da;
C51 COMPILER V9.56.0.0   I2C                                                               12/18/2019 10:58:23 PAGE 3   

 118   1        unsigned char i;
 119   1        
 120   1        for(i=0;i<8;i++)
 121   1        {   
 122   2          SCL = 1;
 123   2          Delay5us();
 124   2          da <<= 1;
 125   2          if(SDA) 
 126   2          da |= 0x01;
 127   2          SCL = 0;
 128   2          Delay5us();
 129   2        }
 130   1        return da;
 131   1      }


MODULE INFORMATION:   STATIC OVERLAYABLE
   CODE SIZE        =    141    ----
   CONSTANT SIZE    =   ----    ----
   XDATA SIZE       =   ----    ----
   PDATA SIZE       =   ----    ----
   DATA SIZE        =   ----    ----
   IDATA SIZE       =   ----    ----
   BIT SIZE         =   ----       1
END OF MODULE INFORMATION.


C51 COMPILATION COMPLETE.  0 WARNING(S),  0 ERROR(S)
